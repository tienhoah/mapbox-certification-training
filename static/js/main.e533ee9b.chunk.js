(this["webpackJsonpmapbox-certification-training"]=this["webpackJsonpmapbox-certification-training"]||[]).push([[0],{104:function(e,t,n){"use strict";n.r(t);var a=n(0),o=n.n(a),r=n(9),i=n.n(r),u=(n(80),n(81),n(36)),c=n.n(u),l=n(64),s=n(52),p=n(53),d=n(54),f=n(65),m=n(63),b=n(30),v=n(31),h=n.n(v),g=(n(83),n(55)),y=n.n(g).a.create({baseURL:"".concat("https://api.translink.ca/rttiapi/v1/buses")}),E=n(56);function j(){var e=Object(E.a)(["\n  text-decoration: underline;\n"]);return j=function(){return e},e}var O=n(57).a.span(j()),R=function(e){var t=e.feature.properties,n=t.vehicle_no,a=t.destination,r=t.direction,i=t.record_time,u=t.route_no,c="https://new.translink.ca/next-bus/results/#/text/route/".concat(u,"/direction/").concat(r.toLowerCase());return o.a.createElement("div",{id:"popup-".concat(n)},o.a.createElement("h3",null,"Vehicle Number-",n),o.a.createElement("div",null,o.a.createElement(O,null,"Bus No:")," ",o.a.createElement("strong",null,u)),o.a.createElement("div",null,o.a.createElement(O,null,"Destination:")," ",a),o.a.createElement("div",null,o.a.createElement(O,null,"Direction:")," ",r),o.a.createElement("div",null,o.a.createElement(O,null,"Record Time:")," ",i),o.a.createElement("div",null,o.a.createElement("a",{target:"_",href:c},o.a.createElement("span",null,"Click to track next ",u," bus")," ")))},k=function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])},w={width:"100vw",height:"100vh",position:"absolute"},S=function(e){var t=e.currentRoute,n=Object(a.useRef)(null),r=Object(a.useRef)(new h.a.Popup({offset:10})),u=Object(a.useState)(null),c=Object(b.a)(u,2),l=c[0],s=c[1],p=Object(a.useCallback)((function(e,t){y.get("",{params:{apikey:"9IIQ3pqDsGWf9EB3UeIE",routeNo:t}}).then((function(t){var n={type:"FeatureCollection",features:[]};t.data.forEach((function(e){var t=[e.Longitude,e.Latitude],a={type:"Feature",geometry:{type:"Point",coordinates:t},properties:{vehicle_no:e.VehicleNo,record_time:e.RecordedTime,direction:e.Direction,destination:e.Destination,coordinates:t,route_map:e.RouteMap,route_no:e.RouteNo}};n.features.push(a)})),void 0!==e.getSource("bus")&&e.getSource("bus").setData(n)})),e.on("mouseenter","bus",(function(t){e.getCanvas().style.cursor="pointer";for(var n=t.features[0].geometry.coordinates.slice();Math.abs(t.lngLat.lng-n[0])>180;)n[0]+=t.lngLat.lng>n[0]?360:-360;var a=document.createElement("div");i.a.render(o.a.createElement(R,{feature:t.features[0]}),a),r.current.setLngLat(n).setDOMContent(a).addTo(e)})),e.on("mouseleave","bus",(function(){e.getCanvas().style.cursor=""}))}),[]);return Object(a.useEffect)((function(){h.a.accessToken="pk.eyJ1Ijoibmlja2hvYW5nMTEiLCJhIjoiY2tlYWEzbm43MHl6MjM0azBsem13aXc2NSJ9.JyBqXp1EhjTJqGryYB-uog";l?p(l,t):function(e){var t=e.setMap,n=e.mapContainer,a=new h.a.Map({container:n.current,style:"mapbox://styles/nickhoang11/ckeaaht6x03hz19plpnhqkg6h",center:[-122.98,49.26427],zoom:11});a.on("load",(function(){t(a),a.addSource("satellite-map",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:256}),a.loadImage("https://upload.wikimedia.org/wikipedia/commons/c/c4/Translinkbus.png",(function(e,t){if(e)throw e;a.addImage("blue-bus",t),a.addSource("bus",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),a.addLayer({id:"bus",type:"symbol",source:"bus",layout:{"icon-image":["case",["==",["get","direction"],"WEST"],"bus",["==",["get","direction"],"SOUTH"],"bus","blue-bus"],"icon-size":["case",["==",["get","direction"],"WEST"],1.1,["==",["get","direction"],"SOUTH"],1.1,.4],"icon-allow-overlap":!0}}),a.addLayer({id:"satellite",source:"satellite-map",type:"raster",layout:{visibility:"none"}},"bus")})),a.on("zoom",(function(){a.getZoom()>13?a.setLayoutProperty("satellite","visibility","visible"):a.setLayoutProperty("satellite","visibility","none")})),a.on("click","bus",(function(e){a.flyTo({center:e.features[0].geometry.coordinates,speed:.3})})),a.addControl(new h.a.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"top-left")}))}({setMap:s,mapContainer:n})}),[t,p,l]),k((function(){l&&p(l,t)}),5e3),o.a.createElement("div",{ref:function(e){return n.current=e},style:w})},C=n(37),I=n(143),L=n(144),x=n(137),B=Object(x.a)({option:{fontSize:15,"& > span":{marginRight:10,fontSize:18}},autoCompleteStyle:{backGround:"red",position:"absolute",zIndex:1e3,background:"#bfd5df",top:10,right:15}}),M=function(e){var t=e.currentRoute,n=e.allRoutes,r=e.updateBusRoute,i=B(),u=Object(a.useState)(t),c=Object(b.a)(u,2),l=c[0],s=c[1],p=Object(a.useState)(n),d=Object(b.a)(p,2),f=d[0],m=d[1];return Object(a.useEffect)((function(){n.length>0&&m(n)}),[n]),o.a.createElement("div",{className:i.autoCompleteStyle},o.a.createElement(L.a,{id:"bus-select",style:{width:300},options:f,value:l,classes:{option:i.option},autoHighlight:!0,onChange:function(e,t){r(null===t?"":t.label),s(t)},getOptionLabel:function(e){return""===e?"":e.label},renderOption:function(e){return o.a.createElement("span",null,e.label)},renderInput:function(e){return o.a.createElement(I.a,Object.assign({},e,{label:"Active bus",variant:"outlined",inputProps:Object(C.a)(Object(C.a)({},e.inputProps),{},{autoComplete:"new-password"})}))}}))},T=function(e){Object(f.a)(n,e);var t=Object(m.a)(n);function n(){var e;Object(p.a)(this,n);for(var a=arguments.length,o=new Array(a),r=0;r<a;r++)o[r]=arguments[r];return(e=t.call.apply(t,[this].concat(o))).state={currentRoute:"",availableRoutes:["99","145"],allRoutes:[]},e.updateBusRoute=function(t){e.setState({currentRoute:t})},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=Object(s.a)(c.a.mark((function e(){var t,n,a,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y.get("",{params:{apikey:"9IIQ3pqDsGWf9EB3UeIE"}});case 2:t=e.sent,n=t?t.data.map((function(e){return e.RouteNo})):[],a=new Set(n),o=Object(l.a)(a).map((function(e){return{label:e}})),this.setState({allRoutes:o});case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(M,{currentRoute:this.state.currentRoute,allRoutes:this.state.allRoutes,updateBusRoute:this.updateBusRoute}),o.a.createElement(S,{currentRoute:this.state.currentRoute}))}}]),n}(a.Component);var z=function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(T,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},75:function(e,t,n){e.exports=n(104)},80:function(e,t,n){},81:function(e,t,n){}},[[75,1,2]]]);
//# sourceMappingURL=main.e533ee9b.chunk.js.map