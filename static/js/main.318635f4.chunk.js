(this["webpackJsonpmapbox-certification-training"]=this["webpackJsonpmapbox-certification-training"]||[]).push([[0],{50:function(e,t,n){e.exports=n(78)},55:function(e,t,n){},56:function(e,t,n){},78:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(10),i=n.n(o),c=(n(55),n(56),n(31)),u=n(32),l=n(49),s=n(48),d=n(12),p=n(13),f=n.n(p),m=(n(57),n(33)),b=n.n(m).a.create({baseURL:"".concat("https://api.translink.ca/rttiapi/v1/buses")}),v=n(8),g=n(1);function h(){var e=Object(v.a)(["\n  text-decoration: underline;\n"]);return h=function(){return e},e}var y=g.default.span(h()),E=function(e){var t=e.feature.properties,n=t.vehicle_no,a=t.destination,o=t.direction,i=t.record_time,c=t.route_no,u="https://new.translink.ca/next-bus/results/#/text/route/".concat(c,"/direction/").concat(o.toLowerCase());return r.a.createElement("div",{id:"popup-".concat(n)},r.a.createElement("h3",null,"Vehicle Number-",n),r.a.createElement("div",null,r.a.createElement(y,null,"Destination:")," ",a),r.a.createElement("div",null,r.a.createElement(y,null,"Direction:")," ",o),r.a.createElement("div",null,r.a.createElement(y,null,"Record Time:")," ",i),r.a.createElement("div",null,r.a.createElement("a",{target:"_",href:u},r.a.createElement("span",null,"Click to track next ",c," bus")," ")))},j=function(e,t){var n=Object(a.useRef)();Object(a.useEffect)((function(){n.current=e}),[e]),Object(a.useEffect)((function(){if(null!==t){var e=setInterval((function(){n.current()}),t);return function(){return clearInterval(e)}}}),[t])},R={width:"100vw",height:"100vh",position:"absolute"},k=function(e){var t=e.currentRoute,n=Object(a.useRef)(null),o=Object(a.useRef)(new f.a.Popup({offset:10})),c=Object(a.useState)(null),u=Object(d.a)(c,2),l=u[0],s=u[1],p=Object(a.useCallback)((function(e,t){b.get("",{params:{apikey:"9IIQ3pqDsGWf9EB3UeIE",routeNo:t}}).then((function(t){var n={type:"FeatureCollection",features:[]};t.data.forEach((function(e){var t=[e.Longitude,e.Latitude],a={type:"Feature",geometry:{type:"Point",coordinates:t},properties:{vehicle_no:e.VehicleNo,record_time:e.RecordedTime,direction:e.Direction,destination:e.Destination,coordinates:t,route_map:e.RouteMap,route_no:e.RouteNo}};n.features.push(a)})),void 0!==e.getSource("bus")&&e.getSource("bus").setData(n)})),e.on("mouseenter","bus",(function(t){e.getCanvas().style.cursor="pointer";for(var n=t.features[0].geometry.coordinates.slice();Math.abs(t.lngLat.lng-n[0])>180;)n[0]+=t.lngLat.lng>n[0]?360:-360;var a=document.createElement("div");i.a.render(r.a.createElement(E,{feature:t.features[0]}),a),o.current.setLngLat(n).setDOMContent(a).addTo(e)})),e.on("mouseleave","bus",(function(){e.getCanvas().style.cursor=""}))}),[]);return Object(a.useEffect)((function(){f.a.accessToken="pk.eyJ1Ijoibmlja2hvYW5nMTEiLCJhIjoiY2tlYWEzbm43MHl6MjM0azBsem13aXc2NSJ9.JyBqXp1EhjTJqGryYB-uog";l?p(l,t):function(e){var t=e.setMap,n=e.mapContainer,a=new f.a.Map({container:n.current,style:"mapbox://styles/nickhoang11/ckeaaht6x03hz19plpnhqkg6h",center:[-123.11001,49.26427],zoom:11.5});a.on("load",(function(){t(a),a.addSource("satellite-map",{type:"raster",url:"mapbox://mapbox.satellite",tileSize:256}),a.loadImage("https://upload.wikimedia.org/wikipedia/commons/c/c4/Translinkbus.png",(function(e,t){if(e)throw e;a.addImage("blue-bus",t),a.addSource("bus",{type:"geojson",data:{type:"FeatureCollection",features:[]}}),a.addLayer({id:"bus",type:"symbol",source:"bus",layout:{"icon-image":["case",["==",["get","direction"],"WEST"],"bus",["==",["get","direction"],"SOUTH"],"bus","blue-bus"],"icon-size":["case",["==",["get","direction"],"WEST"],1.1,["==",["get","direction"],"SOUTH"],1.1,.4],"icon-allow-overlap":!0}}),a.addLayer({id:"satellite",source:"satellite-map",type:"raster",layout:{visibility:"none"}},"bus")})),a.on("zoom",(function(){a.getZoom()>13?a.setLayoutProperty("satellite","visibility","visible"):a.setLayoutProperty("satellite","visibility","none")})),a.on("click","bus",(function(e){a.flyTo({center:e.features[0].geometry.coordinates,speed:.3})}))}))}({setMap:s,mapContainer:n})}),[t,p,l]),j((function(){l&&p(l,t)}),5e3),r.a.createElement("div",{ref:function(e){return n.current=e},style:R})},O=n(84),w=n(85);function x(){var e=Object(v.a)(["\n  position: absolute;\n  z-index: 1000;\n  border: 1px solid;\n  border-radius: 5px;\n  background: #adbec9;\n  align-items: center;\n  flex-direction: row;\n  top: 10px;\n  left: 10px;\n"]);return x=function(){return e},e}function S(){var e=Object(v.a)(["\n  z-index: 1000;\n  margin: 10px;\n"]);return S=function(){return e},e}var C=Object(g.default)(O.a)(S()),L=Object(g.default)(O.a)(x()),T=function(e){var t=e.currentRoute,n=e.availableRoutes,o=e.updateBusRoute,i=Object(a.useState)(t),c=Object(d.a)(i,2),u=c[0],l=c[1];return r.a.createElement(L,null,n.map((function(e){return r.a.createElement(C,{key:e,margin:{vertical:"small"}},r.a.createElement(w.a,{name:"prop",checked:u===e,label:"Bus ".concat(e),onChange:function(t){l(e),o(e)}}))})))},B=function(e){Object(l.a)(n,e);var t=Object(s.a)(n);function n(){var e;Object(c.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).state={currentRoute:"99",availableRoutes:["99","145"]},e.updateBusRoute=function(t){e.setState({currentRoute:t})},e}return Object(u.a)(n,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(T,{currentRoute:this.state.currentRoute,availableRoutes:this.state.availableRoutes,updateBusRoute:this.updateBusRoute}),r.a.createElement(k,{currentRoute:this.state.currentRoute}))}}]),n}(a.Component);var M=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(B,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(M,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[50,1,2]]]);
//# sourceMappingURL=main.318635f4.chunk.js.map